# FinTeen — твоя первая финансовая стратегия

Production-ready микросервисная платформа для обучения детей финансовой грамотности. Современный fintech продукт уровня 2026 с геймификацией, визуализацией данных и интуитивным интерфейсом.

## 🎯 О платформе

**FinTeen** — интерактивная образовательная платформа, которая помогает детям освоить основы финансовой грамотности через практические сценарии в безопасной виртуальной среде. Платформа использует геймификацию, систему уровней и наград для мотивации к обучению.

### Ключевые особенности

- 🎮 **Геймификация** — система уровней, XP, достижений, бейджей, daily challenges
- 📊 **Визуализация** — графики доходов/расходов, категорий, прогресса, статистика
- 💰 **Виртуальный баланс** — безопасное обучение без реальных денег
- 🎯 **Практические сценарии** — планирование бюджета, накопления, симулятор вклада
- 📚 **Образовательный модуль** — квизы по финансовой грамотности, пошаговое обучение
- 🛡️ **Антискам обучение** — специальные квизы про финансовые мошенничества
- 👨‍👩‍👧 **Родительский режим** — просмотр прогресса ребенка и рекомендации
- 📄 **Отчеты** — экспорт финансового отчета в PDF
- 🎲 **Демо-режим** — предзаполненные данные для демонстрации
- 📈 **Админ-панель** — полная аналитика платформы, проблемные темы, метрики
- 📱 **Адаптивный дизайн** — работает на всех устройствах (mobile-first)
- 🌍 **Мультиязычность** — русский и английский языки с сохранением выбора
- 🎨 **Современный UI** — дизайн уровня Revolut/Monzo 2026 с анимациями
- 🔄 **Event-driven архитектура** — Redis pub/sub для межсервисного взаимодействия
- 📝 **Структурированное логирование** — correlation-id для трейсинга запросов

## 🏗 Архитектура

Проект построен на микросервисной архитектуре с четким разделением ответственности:

```
┌─────────────┐
│   Frontend  │ (Next.js 14, TypeScript, TailwindCSS, Framer Motion)
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ API Gateway │ (FastAPI, роутинг, проксирование)
└──────┬──────┘
       │
       ├──────────┬──────────┬──────────┐
       ▼          ▼          ▼          ▼
┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐
│   Auth   │ │   User   │ │   Game   │ │ Progress │
│ Service  │ │ Service  │ │ Service  │ │ Service  │
└────┬─────┘ └────┬─────┘ └────┬─────┘ └────┬─────┘
     │           │            │            │
     └───────────┴────────────┴────────────┘
                    │
         ┌──────────┴──────────┐
         ▼                     ▼
    ┌─────────┐          ┌─────────┐
    │PostgreSQL│          │  Redis  │
    └─────────┘          └─────────┘
```

### Сервисы

- **api-gateway** (8000) — единая точка входа, роутинг запросов к микросервисам, проксирование
- **auth-service** (8001) — аутентификация и авторизация (JWT access + refresh токены)
- **user-service** (8002) — управление пользователями, баланс, уровни, XP, обработка событий из Redis (pub/sub)
- **game-service** (8003) — игровая логика: планирование бюджета, накопления, цели, генерация событий (`goal_completed`, `budget_planned`, `xp_added`)
- **progress-service** (8004) — транзакции, квесты, история прогресса (raw SQL для обхода FK валидации)
- **education-service** (8005) — квизы, бейджи, достижения, guided mode, daily challenges, антискам обучение
- **admin-service** (8010) — админ-панель с аналитикой, статистикой платформы, проблемными темами
- **analytics-service** (8011) — сбор анонимных метрик, аналитика ошибок и эффективности сценариев
- **frontend** (3000) — Next.js приложение с UI-kit, i18n, темами и богатой анимацией
- **postgres** (5432) — база данных PostgreSQL
- **redis** (6379) — кеширование и шина событий (pub/sub для межсервисного взаимодействия)
- **adminer** (8080) — веб-интерфейс для управления БД

## 🚀 Быстрый старт

### Требования

- Docker 20.10+
- Docker Compose 2.0+

### Запуск

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd devhack
```

2. Создайте файл `.env` на основе `.env.example`:
```bash
cp .env.example .env
```

3. Отредактируйте `.env` и установите необходимые значения:
```env
JWT_SECRET_KEY=your-secret-key-min-32-chars
POSTGRES_USER=fintech_user
POSTGRES_PASSWORD=fintech_pass
POSTGRES_DB=fintech_db
```

4. Запустите все сервисы:
```bash
docker-compose up -d
```

5. Дождитесь инициализации всех сервисов (проверьте логи):
```bash
docker-compose logs -f
```

6. Откройте в браузере:
- **Frontend**: http://localhost:3000
- **API Gateway**: http://localhost:8000
- **Adminer** (БД): http://localhost:8080
- **Swagger документация**:
  - Auth Service: http://localhost:8001/docs
  - User Service: http://localhost:8002/docs
  - Game Service: http://localhost:8003/docs
  - Progress Service: http://localhost:8004/docs

## 📦 Структура проекта

```
.
├── docker-compose.yml          # Оркестрация всех сервисов
├── .env.example                # Пример конфигурации
├── README.md                   # Документация
├── Makefile                    # Утилиты для управления
├── backend/                    # Backend сервисы
│   ├── api-gateway/           # API Gateway
│   ├── auth-service/          # Сервис аутентификации
│   ├── user-service/          # Сервис пользователей
│   ├── game-service/          # Игровая логика
│   └── progress-service/      # Прогресс и транзакции
└── frontend/                   # Next.js приложение
    ├── src/
    │   ├── app/               # App Router страницы
    │   ├── components/        # React компоненты
    │   ├── lib/               # Утилиты, API клиент
    │   ├── store/             # Zustand state management
    │   └── locales/           # i18n переводы
```

Каждый backend сервис имеет структуру:
```
service-name/
├── app/
│   ├── main.py               # Точка входа FastAPI
│   ├── core/                 # Конфигурация, БД, безопасность
│   ├── models/               # SQLAlchemy модели
│   ├── schemas/              # Pydantic схемы
│   ├── services/             # Бизнес-логика
│   └── routers/              # API endpoints
├── alembic/                  # Миграции БД
├── Dockerfile
└── requirements.txt
```

## 🎮 Функциональность

### MVP функции

- ✅ **Регистрация и авторизация** — JWT токены, безопасное хеширование паролей
- ✅ **Профиль пользователя** — редактирование данных, просмотр статистики
- ✅ **Виртуальный баланс** — управление виртуальными деньгами
- ✅ **Планирование бюджета** — интерактивный сценарий с категориями
- ✅ **Накопления** — создание целей, пополнение, проценты (5%)
- ✅ **Система уровней и XP** — прогрессия, награды за действия
- ✅ **История транзакций** — полная история с фильтрацией и пагинацией
- ✅ **Дашборд** — обзор баланса, уровня, XP, быстрые действия
- ✅ **Визуализация данных** — графики доходов/расходов, категорий
- ✅ **Сохранение прогресса** — все данные сохраняются в БД

### Дополнительно

- ✅ **Обучающий модуль** — мини-квизы по ключевым финансовым терминам, Guided Mode (пошаговое обучение)
- ✅ **Бейджи и достижения** — награды за первый бюджет, накопления, квизы и серию действий
- ✅ **Daily Challenge** — ежедневное задание с наградой XP
- ✅ **Demo-режим** — авто-создание демо-аккаунта с красивой статистикой для жюри
- ✅ **Родительский режим** — отдельная страница с индикаторами поведения и рекомендациями
- ✅ **PDF-отчет** — страница отчета с экспортом через `Print to PDF`
- ✅ **Симулятор вклада** — сравнение ставок и риск-профилей (консервативный / сбалансированный / агрессивный)
- ✅ **Русский и английский язык** (i18n) — переключение на лету
- ✅ **Светлая и тёмная тема** — автоматическое определение системной темы
- ✅ **Адаптивный дизайн** (mobile-first) — работает на всех устройствах
- ✅ **UI-kit компонентов** — переиспользуемые компоненты
- ✅ **Swagger документация** — для всех сервисов
- ✅ **Cookie consent** — согласие на использование cookies
- ✅ **Legal pages** — Privacy Policy, Terms of Service, Public Offer
- ✅ **Contact/Support** — страницы контактов и поддержки
- ✅ **404 страница** — красивая и запоминающаяся страница ошибки

## 🎨 Дизайн

### Цветовая палитра

- **Primary**: `#50B848` (зеленый) — основной цвет бренда
- **Secondary**: `#BDCBEC` (голубой) — акцентный цвет
- **Gradients** — плавные переходы для современного вида
- **Glassmorphism** — эффекты прозрачности и размытия

### UI-kit включает

- **Button** — primary/secondary/ghost варианты с анимациями
- **Card** — карточки с эффектами глубины и hover
- **Modal** — модальные окна с анимациями
- **ProgressBar** — анимированные индикаторы прогресса
- **CircularProgress** — круговые индикаторы (для XP)
- **Badge** — бейджи для статусов
- **AnimatedCounter** — плавный счетчик чисел
- **Chart** — графики (recharts)

### Дизайн-система

- **Радиусы**: 20-28px для современного вида
- **Тени**: мягкие, многослойные для глубины
- **Анимации**: 150-300ms для плавности
- **Типографика**: гибкая система размеров
- **Spacing**: консистентные отступы

## 🔐 Безопасность

- **JWT access + refresh токены** — безопасная аутентификация
- **Хеширование паролей** (bcrypt) — пароли не хранятся в открытом виде
- **CORS конфигурация** — защита от межсайтовых запросов
- **Валидация всех входных данных** (Pydantic) — защита от некорректных данных
- **Структурированная обработка ошибок** — безопасные сообщения об ошибках
- **Environment-based settings** — конфигурация через переменные окружения

## 📊 Game Logic

### Сценарий 1: Планирование бюджета

1. Пользователь получает доход (виртуальные деньги)
2. Распределяет доход по категориям (еда, транспорт, развлечения и т.д.)
3. Система проверяет баланс:
   - Если распределение сбалансировано (в пределах 10%) → награда **50 XP**
   - Если нет → обучающий фидбек + **10 XP**
4. Создается транзакция типа "income"
5. Баланс обновляется

**Критерии успеха:**
- Распределение должно быть в пределах 10% от дохода
- Минимум 3 категории для лучшего планирования

### Сценарий 2: Накопления

1. Пользователь создает цель накопления (название + сумма)
2. Пополняет цель из виртуального баланса
3. Может применить проценты (5% от текущей суммы)
4. При достижении цели:
   - Цель помечается как завершенная
   - Награда **100 XP**
   - Создается транзакция "goal_completed"

**Особенности:**
- Проценты начисляются только на незавершенные цели
- Нельзя пополнить завершенную цель
- Нельзя пополнить больше, чем есть на балансе

### XP система

- **Level = floor(xp / 100) + 1** — уровень рассчитывается автоматически
- **Награды:**
  - Планирование бюджета (сбалансированное): 50 XP
  - Планирование бюджета (несбалансированное): 10 XP
  - Достижение цели накопления: 100 XP
- **Постепенное усложнение** — чем выше уровень, тем сложнее задачи

## 🗄 База данных

### Основные сущности

- **User**: id, email, username, hashed_password, level, xp, balance, created_at
- **Goal**: id, user_id, title, target_amount, current_amount, completed, created_at
- **Transaction**: id, user_id, type, amount, description, created_at
  - Типы: `income`, `expense`, `savings_deposit`, `interest`, `goal_completed`
- **Quest**: id, title, difficulty, reward_xp
- **QuestProgress**: id, user_id, quest_id, completed, score
 - **Quiz**: id, title, difficulty, xp_reward
 - **Question**: id, quiz_id, question, options (JSON), correct_answer
 - **QuizProgress**: id, user_id, quiz_id, score, completed
 - **Badge**: id, title, description, icon, condition (JSONB)
 - **UserBadge**: user_id, badge_id, unlocked_at
 - **Achievement**: id, title, description, icon, condition (JSONB)
 - **UserAchievement**: user_id, achievement_id, unlocked_at
 - **DailyChallenge**: id, title, description, challenge_type, xp_reward, condition (JSONB)
 - **UserDailyChallenge**: user_id, daily_challenge_id, completed_at

### Особенности

- Все связи через foreign keys на уровне БД
- Миграции через Alembic (автоматическое применение при старте)
- **Transaction модель** — использует raw SQL для обхода SQLAlchemy FK валидации
- Индексы на часто используемых полях (user_id, created_at)

## 🐳 Docker

Все сервисы контейнеризированы с:

- **Multi-stage builds** — оптимизация размера образов
- **Healthchecks** — проверка работоспособности сервисов
- **Volume для БД** — персистентное хранение данных
- **Internal network** — изолированная сеть для сервисов
- **Depends_on** — правильный порядок запуска
- **Entrypoint скрипты** — автоматическое применение миграций

## 🔄 Git Workflow

Проект использует Conventional Commits:

- `feat:` - новая функциональность
- `fix:` - исправление багов
- `refactor:` - рефакторинг кода
- `chore:` - обновление зависимостей, конфигурации
- `docs:` - документация

## 📈 API Endpoints

### Auth Service

- `POST /api/v1/auth/register` - Регистрация нового пользователя
- `POST /api/v1/auth/login` - Вход в систему
- `POST /api/v1/auth/refresh` - Обновление access токена
- `GET /api/v1/auth/me` - Информация о текущем пользователе

### User Service

- `GET /api/v1/users/me` - Получение профиля
- `PUT /api/v1/users/me` - Обновление профиля
- `POST /api/v1/users/balance` - Изменение баланса (положительное/отрицательное)
- `POST /api/v1/users/xp` - Добавление XP
- `GET /api/v1/users/me/level` - Информация об уровне и прогрессе

### Game Service

- `POST /api/v1/budget/plan` - Планирование бюджета (доход + категории)
- `POST /api/v1/savings/goals` - Создание цели накопления
- `GET /api/v1/savings/goals` - Список целей пользователя
- `POST /api/v1/savings/deposit` - Пополнение цели
- `POST /api/v1/savings/interest/{goal_id}` - Применение процентов к цели

### Progress Service

- `POST /api/v1/transactions` - Создание транзакции (автоматически при операциях)
- `GET /api/v1/transactions` - История транзакций (с пагинацией)
  - Query params: `page`, `page_size`
- `GET /api/v1/quests` - Список доступных квестов
- `GET /api/v1/quests/progress` - Прогресс пользователя по квестам
- `POST /api/v1/quests/progress` - Обновление прогресса по квесту

**Все запросы проходят через API Gateway**: `http://localhost:8000/api/v1/{service}/{endpoint}`

## 🎯 Как это работает

### Пользовательский поток

1. **Регистрация/Вход**
   - Пользователь регистрируется или входит в систему
   - Получает JWT токены (access + refresh)
   - Токены сохраняются в localStorage

2. **Дашборд**
   - Отображается баланс, уровень, XP
   - Круговой индикатор прогресса до следующего уровня
   - Быстрые действия: планирование бюджета, накопления, история

3. **Планирование бюджета**
   - Пользователь вводит доход
   - Добавляет категории с суммами
   - Система проверяет баланс и начисляет XP
   - Создается транзакция "income"
   - Баланс обновляется

4. **Накопления**
   - Пользователь создает цель (название + сумма)
   - Пополняет цель из баланса
   - Может применить проценты
   - При достижении цели получает XP и транзакцию

5. **История транзакций**
   - Просмотр всех транзакций с фильтрацией
   - Графики доходов/расходов за последние 7 дней
   - Круговая диаграмма по категориям
   - Статистика: общий доход, расходы, текущий баланс

### Технические детали

- **Микросервисы** общаются через HTTP (внутренняя сеть Docker)
- **API Gateway** проксирует все запросы к нужным сервисам
- **JWT токены** передаются в заголовке `Authorization: Bearer <token>`
- **Транзакции** создаются автоматически при всех операциях
- **Баланс и XP** обновляются через вызовы к user-service
- **Миграции** применяются автоматически при старте progress-service

## 🛠 Разработка

### Локальная разработка

Для разработки отдельного сервиса:

```bash
cd backend/auth-service
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
uvicorn app.main:app --reload --port 8001
```

### Миграции

Создание новой миграции:
```bash
cd backend/auth-service
alembic revision --autogenerate -m "description"
```

Применение миграций:
```bash
alembic upgrade head
```

**Примечание**: Миграции progress-service применяются автоматически через entrypoint.sh

### Логирование

Все сервисы логируют:
- HTTP запросы (FastAPI автоматически)
- Ошибки с полным traceback
- Создание транзакций
- Обновление баланса/XP

Просмотр логов:
```bash
docker-compose logs -f <service-name>
```

## 🐛 Известные особенности

- **Transaction модель** использует raw SQL вместо ORM для обхода проблем с foreign key валидацией в SQLAlchemy
- **Миграции** применяются автоматически только для progress-service (через entrypoint.sh)
- **Баланс** может быть отрицательным (для обучения)

## 📝 Лицензия

Проект создан для хакатона DevHack №6, Центр-Инвест.

## 👥 Команда

Разработано командой **CLV-DIGITAL**

- Website: https://clv-digital.tech
- Contact: тестовые контакты (см. страницу /contact)

---

**FinTeen** — твоя первая финансовая стратегия 🚀
